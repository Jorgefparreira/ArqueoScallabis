let projectList = [
    {
      "id": "chao-da-feira",
      "name": "Posto de combustíveis de Chão da Feira",
      "title": "Acompanhamento arqueológico da construção do posto de abastecimento de combustíveis líquidos de Chão da Feira, Porto de Mós",
      "partnership": "",
      "client": "Cliente: Léguas e Destinos, Lda e Espiral Genial, Lda",
      "description": "Acompanhamento arqueológico durante as fases com afectação ao solo. Não houveram ocorrências patrimoniais a registar, uma vez que o terreno já se encontrava profundamente alterado na sua estratigrafia original devido à construção em momentos anteriores de dois postos de abastecimento de combustíveis.",
      "coverImage": "img/chao-da-feira(1).jpg",
      "images": ["img/chao-da-feira(1).jpg","img/chao-da-feira(2).jpg","img/chao-da-feira(3).jpg"]
    },
    {
      "id": "convento-st-antonio-convalescenca",
      "name": "Convento de St António da Convalescença",
      "title": "Levantamento patrimonial e arquitectónico do antigo Convento de Santo António da Convalescença, S. Domingos de Benfica, Lisboa",
      "partnership": "",
      "client": "Cliente: Succeed, Investimentos Imobiliários e Formação Profissional, SA",
      "description": "Levantamento patrimonial e arquitectónico de todo o edifício e respectivas dependências, de construção original seiscentista, com recurso a fotografia e ortofotografia dos elementos patrimoniais e investigação histórica acerca. Destacam-se os painéis de azulejos dos Sécs. XVII e XVIII, bem como as bicas de água do Séc. XVI do tanque do antigo Convento. Estudo integrado no projecto de reabilitação do edifício para ser submetido à CM Lisboa e à DGPC.",
      "coverImage": "img/convento-st-antonio_1.jpg",
      "images": ["img/convento-st-antonio_3.jpg","img/convento-st-antonio_2.jpg","img/convento-st-antonio_1.jpg"]
    },
    {
      "id": "central-fotovoltaica-arronchais",
      "name": "Central Fotovoltaica de Arronchais, Moura",
      "title": "Prospecção arqueológica para o EIA do projecto da Central Fotovoltaica de Arronchais, Moura",
      "partnership": "",
      "client": "Parceria: Emerita, Empresa Portuguesa de Arqueologia",
      "description": "Prospecção sistemática na área de construção da central fotovoltaica e prospecção dirigida na linha aérea, destacando-se a identificação de diversos elementos etnográficos, bem como a relocalização de diversos sítios arqueológicos.",
      "coverImage": "img/central-fotovoltaica-moura_1.jpg",
      "images": ["img/central-fotovoltaica-moura_3.jpg","img/central-fotovoltaica-moura_2.jpg","img/central-fotovoltaica-moura_1.jpg"]
    },
    {
      "id": "central-fotovoltaica-encarnado",
      "name": "Central Fotovoltaica de Encarnado",
      "title": "Prospecção arqueológica para o EIA do projecto da Central Fotovoltaica de Encarnado, Cartaxo e Santarém",
      "partnership": "",
      "client": "Parceria: Emerita, Empresa Portuguesa de Arqueologia",
      "description": "Prospecção sistemática na área de construção da central fotovoltaica e respectiva linha aérea, destacando-se a relocalização de diversos elementos etnográficos, nomeadamente uma ponte vernacular, mina de água, columbário, tanque e depósito de água associados a um casal agrícola, bem como 3 fornos de cal de Época Moderna/Contemporânea.",
      "coverImage": "img/central-fotovoltaica-encarnado_1.jpg",
      "images": ["img/central-fotovoltaica-encarnado_3.jpg","img/central-fotovoltaica-encarnado_2.jpg","img/central-fotovoltaica-encarnado_1.jpg"]
    },
    {
      "id": "rua-martires-patria",
      "name": "Rua dos Mártires da Pátria, Setúbal",
      "title": "Sondagens Arqueológicas na Rua dos Mártires da Pátria, Setúbal",
      "partnership": "",
      "client": "Cliente: D. Rosenberg",
      "description": "Abertura de sondagens arqueológicas manuais de diagnóstico. Identificados vestígios modernos e contemporâneos dos quais se destacam uma base de forno e um conjunto de paredes.",
      "coverImage": "img/rua-dos-martires-da-patria_1.jpg",
      "images": ["img/rua-dos-martires-da-patria_3.jpg","img/rua-dos-martires-da-patria_2.jpg","img/rua-dos-martires-da-patria_1.jpg"]
    },
    {
      "id": "travessa-monteiro-rua-direita",
      "name": "Travessa do Monteiro e a Rua Direita, Coruche",
      "title": "Sondagens Arqueológicas na construção de edifício multifamiliar no gaveto entre a Travessa do Monteiro e a Rua Direita, Coruche",
      "partnership": "",
      "client": "Cliente: Câmara Municipal de Coruche",
      "description": "Abertura de sondagens arqueológicas manuais de diagnóstico. Identificados vestígios de Época Moderna, dos quais se destacam a descoberta de pavimento em lajetas de cerâmica, anteriores ao edifício que ali se localizava.",
      "coverImage": "img/travessa-monteiro-coruche_1.jpg",
      "images": ["img/travessa-monteiro-coruche_2.jpg","img/travessa-monteiro-coruche_3.jpg","img/travessa-monteiro-coruche_1.jpg"]
    },
    {
      "id": "villa-rio-maior",
      "name": "Villa Romana de Rio Maior",
      "title": "Sondagens Arqueológicas na Villa Romana de Rio Maior (requalificação da frente ribeirinha)",
      "partnership": "",
      "client": "Cliente: Construbel, Engenharia Lda",
      "description": "Abertura de sondagens arqueológicas manuais de salvaguarda. Identificados vestígios de Época Romana até à Época Contemporânea, dos quais se destacam a descoberta de pavimento em mosaico de tesselas, 7 numismas do Imperador Galiano e um fragmento de fíbula.",
      "coverImage": "img/villa-rio-maior_1.jpg",
      "images": ["img/villa-rio-maior_2.jpg","img/villa-rio-maior_3.jpg","img/villa-rio-maior_1.jpg"]
    },
    {
      "id": "arquivo",
      "name": "",
      "title": "",
      "partnership": "",
      "client": "",
      "description": "",
      "coverImage": "img/archive-thumb.jpg",
      "images": [""]
    },
    {
      "id": "rua-1-dezembro",
      "name": "Rua 1º de Dezembro, Santarém",
      "title": "Trabalhos arqueológicos na reabilitação de edifício na R. 1º de Dezembro, Santarém",
      "partnership": "",
      "client": "Cliente: Craftrade, Sociedade de Representações e Investimentos Imobiliários, Lda",
      "description": "Sondagens arqueológicas de diagnóstico e acompanhamento das fases de picagem de paredes e de abertura de valas para infraestruturas. Destaca-se a descoberta de uma porta ogival de época medieval, que será reabilitada e restituída à sua função original de acesso ao edifício, mas também um depósito de materiais arqueológicos cerâmicos inteiros, de época Moderna, entre paredes e que possibilitaram a identificação dos proprietários do imóvel no Séc. XVII. Estes materiais vão ficar em exposição após a reabilitação, que irá dar origem a um estabelecimento hoteleiro.",
      "coverImage": "img/rua-1-dezembro-santarem_1.jpg",
      "images": ["img/rua-1-dezembro-santarem_1.jpg","img/rua-1-dezembro-santarem_3.jpg","img/rua-1-dezembro-santarem_4.jpg"]
    }
  ];

  let archiveList = [
    {
      "id":"0",
      "name":"Encosta de Santa Margarida, Santarém",
      "description": {
        "title": "Projecto Global de Estabilização e Consolidação das Encostas de Santarém, Santarém",
        "partnership": "Parceria: Emerita, Empresa Portuguesa de Arqueologia, Lda.",
        "client": "Cliente: Ancorpor, Geotécnica e fundações, Lda. ",
        "text": "Prospecção, abertura de sondagens manuais e mecânicas e  acompanhamento arqueológico para salvaguarda de eventuais vestígios patrimoniais e arqueológicos. Identificados vestígios medievais, modernos e contemporâneos e vestígios osteológicos associados à Igreja de São Mateus."
      },
      "coverImage":"img/Encosta_Sta_Margarida_1.jpg",
      "projectImage1":"img/Encosta_Sta_Margarida_1.jpg",    
      "projectImage2":"img/Encosta_Sta_Margarida_2.jpg",
      "projectImage3":"img/Encosta_Sta_Margarida_4.jpg"  
    },
    {
      "id":"1",
      "name":"Rua da Cruz de Santa Apolónia, Lisboa",
      "description": {
        "title": "Reabilitação do edifício na Rua da Cruz de Santa Apolónia, Lisboa",
        "partnership": "",
        "client": "Cliente: Inês Brandão Arquitetura",
        "text": "Parecer técnico de arqueologia e abertura de sondagens arqueológicas manuais de diagnóstico. Identificados vestígios modernos e contemporâneos, um espaço de calçada e um caneiro possivelmente pombalino."
      },
      "coverImage":"img/Rua_da_Cruz_1.jpg",
      "projectImage1":"img/Rua_da_Cruz_1.jpg",
      "projectImage2":"img/Rua_da_Cruz_2.jpg",
      "projectImage3":"img/Rua_da_Cruz_4.jpg"            
    },
    {
      "id":"2",
      "name":"Forte de São Filipe, Setúbal",
      "description": {
        "title": "Projecto de Estabilização e Consolidação das Barreiras do Forte de S. Filipe, Setúbal",
        "partnership": "",
        "client": "Clientes: Ancorpor, Geotecnia e fundações, Lda",
        "text": "Prospecção, abertura de sondagens manuais e mecânicas e acompanhamento arqueológico para salvaguarda de eventuais vestígios patrimoniais e arqueológicos. Identificados vestígios modernos e contemporâneos, assim como estruturas de suporte estrutural do forte."
      },
      "coverImage":"img/Forte_Sao_Filipe_Setubal_1.jpg",
      "projectImage1":"img/Forte_Sao_Filipe_Setubal_1.jpg",
      "projectImage2":"img/Forte_Sao_Filipe_Setubal_2.jpg",
      "projectImage3":"img/Forte_Sao_Filipe_Setubal_3.jpg"            
    },   
    {
      "id":"3",
      "name":"Avenida 5 de Outubro, Santarém",
      "description": {
        "title": "Reabilitação do edifício n.º 30 da Avenida 5 De Outubro, Santarém",
        "partnership": "",
        "client": "Cliente: Craftrade Lda",
        "text": "Abertura de sondagens arqueológicas manuais de diagnóstico. Identificados vestígios modernos e contemporâneos e construções anteriores ao edificio actual, possivelmente contemporaneas."
      },
      "coverImage":"img/Avenida_5_de_Outubro_Santarem_1.jpg",
      "projectImage1":"img/Avenida_5_de_Outubro_Santarem_1.jpg",
      "projectImage2":"img/Avenida_5_de_Outubro_Santarem_2.jpg",
      "projectImage3":"img/Avenida_5_de_Outubro_Santarem_3.jpg"
    },
    {
      "id":"4",
      "name":"ETAR de Ortiga, Mação",
      "description": {
        "title": "Empreitada de Concepção-Construção da ETAR de Ortiga, Mação",
        "partnership": "",
        "client": "Clientes: Ambiágua, Sa. ",
        "text": "Acompanhamento arqueológico para salvaguarda de eventuais vestígios patrimoniais e arqueológicos."
      },
      "coverImage":"img/ETAR_Ortiga_2.jpg",
      "projectImage1":"img/ETAR_Ortiga_1.jpg",
      "projectImage2":"img/ETAR_Ortiga_2.jpg",
      "projectImage3":"img/ETAR_Ortiga_3.jpg"
    },
    {
      "id":"5",
      "name":"Lg. de Nossa Senhora de Montelavar, Sintra",
      "description": {
        "title": "Reconstrução de edifício no Largo da Igreja de Montelavar, Sintra",
        "partnership": "",
        "client": "Cliente: Esquissos, Arquitetura e Consultoria ",
        "text": "Abertura de sondagens arqueológicas manuais de diagnóstico. Vestígios modernos e contemporâneos e vestígios osteológicos associados a duas sepulturas de cronologia possivelmente moderna."
      },
      "coverImage":"img/Montelavar_1.jpg",
      "projectImage1":"img/Montelavar_1.jpg",
      "projectImage2":"img/Montelavar_2.jpg",
      "projectImage3":"img/Montelavar_3.jpg"
    },
    {
      "id":"6",
      "name":"Rua dos Navegantes, Cascais",
      "description": {
        "title": "Reabilitação de edifício na Rua dos Navegantes, Cascais",
        "partnership": "",
        "client": "Cliente: Esquissos, Arquitetura e Consultadoria",
        "text": "Abertura de sondagens arqueológicas manuais de diagnóstico. Vestígios de época moderna e romana."
      },
      "coverImage":"img/Navegantes_3.jpg",
      "projectImage1":"img/Navegantes_2.jpg",
      "projectImage2":"img/Navegantes_3.jpg",
      "projectImage3":"img/Navegantes_4.jpg"
    }     
  ]
let faqList = [
  ["Quero trabalhar com a ArqueoScallabis. Posso fazer uma candidatura espontânea?", "Sim. Para efetuar uma candidatura espontânea basta enviar o CV para geral@arqueoscallabis.pt. Todas as candidaturas serão alvo da nossa maior atenção."],
  ['Acabei agora a licenciatura em Arqueologia ou tenho pouca experiência na área. Posso enviar o meu CV?', 'Claro! Na ArqueoScallabis valorizamos toda a experiência dos candidatos, na área da Arqueologia e não só.'],
  ['Sou licenciado em Restauro ou Antropologia Biológica. Posso enviar o meu CV?', 'Claro! A ArqueoScallabis também desenvolve projeto na área do Restauro e áreas geográficas com grande probabilidade de aparecerem contextos onde a presença de um antropólogo é obrigatória.'],
  ['Tenho um projeto de construção para realizar. Preciso de serviços de Arqueologia?', 'Depende. Se o projeto estiver inserido numa zona de grau 1 do PDM, se se encontrar perto de uma Zona de Proteção Especial (ZEP) ou se afetar um imóvel classificado ou em vias de classificação, poderão ser necessários trabalhos arqueológicos prévios ou de acompanhamento dos trabalhos de obra. Se o projeto não se enquadra em nenhuma das anteriores situações, os serviços de Arqueologia só serão necessários se a autarquia local ou a Direção Geral do Património Cultural (DGPC) o determinarem. Em caso de dúvida pode sempre entrar em contato connosco através do email geral@arqueoscallabis.pt.'],
  ['O que faz um arqueólogo em obra?', 'O arqueólogo tem a função de identificar a presença de vestígios arqueológicos, registá-los e minimizar os impactos dos trabalhos de obra sobre os mesmos. Desta forma, tenta salvaguardar o possível interesse científico dos vestígios encontrados, ao mesmo tempo que assegura que os mesmos não interferem com o andamento dos trabalhos em execução.'],
  ['Quem tem a obrigação de pagar os serviços de Arqueologia, Restauro ou Antropologia, caso sejam necessários?', 'Qualquer serviço que venha a ser fornecido pela ArqueoScallabis será pago pela entidade contratante do mesmo, isto é, o Dono de Obra ou a Entidade Promotora da mesma. O pagamento de serviços prestado por uma empresa de Arqueologia não é diferente do pagamento de serviços de Ambiente, Higiene e Segurança (HSST), Topografia, ou outros necessários ao bom funcionamento da empreitada.']
] 
let projects = {
  loadList: () => {
    projectList.forEach(project => {
      $("#projects-carousel").append(
        `<div class='project-box'>
          <h3 class='list-title'>${project.name}</h3>
          <a href='/projects/${project.id}' class='page-link'>
            <img type='button' src='/${project.coverImage}' class='img-responsive project-img'>
          </a>
        </div>
      `);
    }); 
  },
  returnList: () => {
    document.querySelector("#project-details").innerHTML = "";
    document.querySelector("#project-container").style.display = "block";
  }, 
  loadProjectDetail: projectId => {
      document.querySelector("#project-container").style.display = "none";
      const project = projectList.find(item => item.id == projectId);
      const {images, title, partnership, client, description} = project;
      let projectImages = "";
      images.forEach(image => {
        projectImages += `<div class="col-sm-6"><img src="/${image}" class="img-responsive modal-img"></div>`;
      });  
      document.querySelector("#project-details").innerHTML = `
        <a href="/#projectos" class="page-link projects-return"><h3><span>&laquo;</span> Projectos</h3></a>
        <br>
        <div class="container">
          <div class="row">
            <div class="col-sm-6">
              <h3>${title}</h3><br>
              <p class="project-partnership"><strong>${partnership}</strong></p>
              <p>${client}</p><br>
              <p>${description}</p>
            </div>
            ${projectImages}
          </div>
          <a href="#projects"><p>&laquo; Voltar</p></a>
        </div>
      `;
      router.loadLinkEvents()
  },
  loadArchive: () => {
    document.querySelector("#project-container").style.display = "none";
    let archiveProjectsHTML = '';
    archiveList.forEach(project => {
      archiveProjectsHTML += `<div class="col-md-4">
      <div class="project-box"><h3 class="list-title">${project.name}</h3><a ng-href="/#!/archive/details/{{project.id}}#projects"><img src="${project.coverImage}" class="img-responsive project-img"></a></div>	
    </div>`
    });

    document.querySelector("#project-details").innerHTML = `
      <div class="projects-return" onclick="projects.returnList()"><h3><span class="{{swing}}">&laquo;</span> Projectos</h3></div>
      <br>
      <div class="container">
        <div class="row">
          <h2 class="project-title">Arquivo de Projectos</h2>
          <br>
          ${archiveProjectsHTML}
        </div>
        <a href="#projects"><p>&laquo; Voltar</p></a>
      </div>
    `;    
  }
};


// google maps api  

const initMap = () => {
  var hqMarker = { lat: 39.238926, lng: -8.685768 };
  var map = new google.maps.Map(document.getElementById('map'), {
    zoom: 14,
    center: hqMarker
  });
  var marker = new google.maps.Marker({
    position: hqMarker,
    map: map
  });
}

let faqs = {
  loadData: () => {
    faqList.forEach((faq, i) => {
      $('#accordion-container').append(`
      <div class="faq-wrapper">
        <div class="faq-header" faq="${i + 1}" open="false">
          <p>${faq[0]} <svg viewBox="0 0 50 50"><path d="M24.909 6.533v37.041M6.728 25.621h36.664" fill="none" stroke="#000" stroke-width="11.511" stroke-linecap="round"/></svg></p>
        </div>
        <div class="faq-body" faq="${i + 1}">
          <p>${faq[1]}</p>
        </div>
      </div>        
      `)
    });
  },
  showAnswer: (e) => {
    if (e.target.getAttribute('open') == "true") {
      $(e.target).siblings(".faq-body").slideUp();
      e.target.querySelector('svg').innerHTML = '<svg viewBox="0 0 50 50"><path d="M24.909 6.533v37.041M6.728 25.621h36.664" fill="none" stroke="#000" stroke-width="11.511" stroke-linecap="round"/></svg>';
      e.target.setAttribute('open', 'false')
    } else {
      $(e.target).siblings(".faq-body").slideDown();
      e.target.querySelector('svg').innerHTML = '<svg viewBox="0 0 50 50"><path d="M6.728 25.62h36.664" fill="none" stroke="#000" stroke-width="11.452" stroke-linecap="round"/></svg>';
      e.target.setAttribute('open', 'true')
    }

  }
}


window.addEventListener('load', event => {
  document.querySelectorAll('#top-navbar a').forEach(anchor => {
    anchor.addEventListener("click", (event) => {
      event.preventDefault()
    });
  })
  document.querySelectorAll(".faq-header").forEach(header => {
    header.addEventListener('click', faqs.showAnswer)
  });
  document.querySelector(".faq-header").click()


  // CAROUSEL

  $('.owl-carousel').owlCarousel({
    center: true,
    loop: true,
    margin: 10,
    responsiveClass: true,
    autoplay: true,
    autoplayTimeout: 3000,
    animateOut: 'slideOutDown',
    animateIn: 'flipInX',
    mergeFit: false,
    merge: true,
    autoplayHoverPause: true,

    responsive: {
      0: {
        items: 2,
        autoplay: false,
        autoplayTimeout: 10000000,
      },
      600: {
        items: 2,
      },
      1000: {
        items: 3,
      }
    }
  })

});


$(function () {

    // $('#contactus-form').validator();

    $('#contactus-form').on('submit', function (e) {

        // if the validator does not prevent form submit
        if (!e.isDefaultPrevented()) {
            var url = "php/EQ/contact-us-mail-script.php";
            $.ajax({
                type: "POST",
                url: url,
                data: $(this).serialize(),
                success: function (data)
                {
                    // data = JSON object that contact.php returns
                    var messageAlert = 'alert-' + data.type;
                    var messageText = data.message;

                    // let's compose Bootstrap alert box HTML
                    var alertBox = '<div class="alert ' + messageAlert + ' alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>' + messageText + '</div>';
                    
                    // If we have messageAlert and messageText
                    if (messageAlert && messageText) {
                        // inject the alert to .messages div in our form
                        $('#contactus-form').find('.messages').html(alertBox);
                        // empty the form
                        $('#contactus-form')[0].reset();
                    }
                }
            });
            return false;
        }
    })
});
let router = {
  loadLinkEvents: () =>{
    document.querySelectorAll(".page-link").forEach(link =>{
      link.addEventListener('click', router.getRoute)
    })  
  },
  getRoute: (e) => {
    e.preventDefault()
    let route = e.target.closest("a").getAttribute("href");
    route = route.split("/");
    route.shift();
    if(route[0][0] === "#" || route[0] === ""){
      router.loadIndex(route[0])
    } else if (route[0] === "projects" || route[0] === "archive"){
      router.loadProjectSection(route)
    } else {
      router.loadPage(route[0])
    }
  }, 
  loadIndex: (section) => {
    document.querySelector("#main-container").style.display = "block";
    document.querySelector("#project-container").style.display = "block";
    document.querySelector("#project-details").innerHTML = '';

    if(section === ""){
      document.querySelector("#home").scrollIntoView({ behavior: 'smooth' });
    } else{
      document.querySelector(section).scrollIntoView({ behavior: 'smooth' });
    }
    router.updateHead("/","ArqueoScallabis","")
  },  
  loadProjectSection: (route) => {
    router.updateHead(`${route[0]}/${route[1]}`, `${route[1]} | ${route[0]}`, "")
    if(route[0] != "arquivo"){
      projects.loadProjectDetail(route[1]);  
    } else {
      projects.loadArchive(route[1]);
    }
  },
  loadPage: (page) =>{
      console.log(page)
      let script = document.createElement('script');
      script.src = `/js/${page}.js`;
      document.head.appendChild(script);
      document.querySelector("#router-container").scrollIntoView();
      script.onload = () => {
        document.querySelector("#main-container").style.display = "none";
        document.querySelector("#router-container").innerHTML = eval(page).html;
        router.updateHead(eval(page).url, eval(page).title, eval(page).description)
      };
  },
  updateHead: (url, title, description) =>{
    window.history.pushState("","", url);
    document.title = title; 
    document.querySelector('meta[name="description"]').setAttribute("content", description);
  }
}  


projects.loadList();
faqs.loadData();
router.loadLinkEvents()